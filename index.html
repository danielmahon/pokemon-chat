<!DOCTYPE html>
<html>
<head>
	 <script src="http://localhost:8080/socket.io/socket.io.js"></script>
	 <title>Impact Game</title>
	 <style type="text/css">
		html,body {
			background-color: #000;
			color: #fff;
			font-family: helvetica, arial, sans-serif;
			margin: 0;
			padding: 0;
			font-size: 12pt;
		}
		
		#canvas {
			position: absolute;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			margin: auto;
			border: 1px solid #555;
		}
	 </style>

	 <script type="text/javascript" src="lib/impact/impact.js"></script>
	 <script type="text/javascript" src="lib/game/main.js"></script>
</head>
<body>
	 <script type="text/javascript">
	 var socket = io.connect('http://localhost:8080');

socket.on('message', function (data) {
       var player = ig.game.getEntitiesByType( EntityPlayer )[0];
	 if(player)
	 {
	 player.messagebox = player.messagebox + '\n' + data + ' disconnected';
	 }
      });	 
	 
	 
//  new player move
socket.on('moveOtherPlayer', function (xstart, ystart, direction, client) {
	 var otherplayer = ig.game.getEntitiesByType( EntityOtherplayer );
	 if(otherplayer)
	 {
		  for(var i in otherplayer)
		  {
			   if(client == otherplayer[i].gamename)
			   {
				    if(direction=='left')
				    {
					otherplayer[i].pos.x = xstart-16; // magic numbers = bad!!
					otherplayer[i].pos.y = ystart;
					otherplayer[i].animation = 7;
				    }
				    if(direction=='right')
				    {
					otherplayer[i].pos.x = xstart+16; // magic numbers = bad!!
					otherplayer[i].pos.y = ystart;
					otherplayer[i].animation = 8;
				    }
				    if(direction=='up')
				    {
					otherplayer[i].pos.x = xstart;
					otherplayer[i].pos.y = ystart-16; // magic numbers = bad!!
					otherplayer[i].animation = 5;
				    }
				    if(direction=='down')
				    {
					otherplayer[i].pos.x = xstart;
					otherplayer[i].pos.y = ystart+16; // magic numbers = bad!!
					otherplayer[i].animation = 6;
				    }
				    
			   }
		  }
	 }
});	 
		 
	  socket.on('netreplayer', function (playerlist) {
        var netplayers = ig.game.getEntitiesByType( EntityOtherplayer );
//////////////loop to see if players exist
	if(netplayers){
		  for(var i in netplayers)
	 {
		  netplayers[i].kill();
	 }}
	 
	for(var i in playerlist)
	 {
	 if(playername != playerlist[i])
	 {
		  ig.game.spawnEntity( EntityOtherplayer, 160, 260, {gamename:playerlist[i]} );
	 }
	 }

/////////////////////////////////
      });
	  
	  
// the new add player
socket.on('addPlayer', function (playerlist,otherplayername,x,y,direction) {
	 var player = ig.game.getEntitiesByType( EntityPlayer )[0];
	 player.messagebox = player.messagebox + '\n' + otherplayername + ' joined.';
	 for(var i = 0;i<playerlist.length;i++)
	 {
		  if(player.gamename != playerlist[i])
		  {  
			   ig.game.spawnEntity( EntityOtherplayer, x, y,
			   {
				    gamename:playerlist[i],
				    animation:6
			   } );
		  }
	 }	
});

socket.on('dropPlayer', function (client)
{
	 var netplayers = ig.game.getEntitiesByType( EntityOtherplayer );
	 if(netplayers)
	 {
		  for(var i in netplayers)
		  {
			   // kill player entity if he exists
			   if(netplayers[i].gamename==client) netplayers[i].kill();
		  }
	 }
});

socket.on('playerPositions', function (players)
{
	 var netplayers = ig.game.getEntitiesByType( EntityOtherplayer );
	 if(netplayers)
	 {
		  for(var i in netplayers)
		  {
			   for(var j in players)
			   {
				    // if names match, update position
				    if(netplayers[i].gamename==players[j].name)
				    {
					     netplayers[i].pos.x = players[j].pos.x;
					     netplayers[i].pos.y = players[j].pos.y;
					     var sw = players[j].facing;
					     switch(sw)
					     {
						      case 'left':
							       netplayers[i].animation = 7;
							       break;
						      case 'right':
							       netplayers[i].animation = 8;
							       break;
						      case 'up':
							       netplayers[i].animation = 5;
							       break;
						      case 'down':
							       netplayers[i].animation = 6;
							       break;
					     };
				    }
			   }
		  }
	 }
});

	</script>
	
	
	<canvas id="canvas"></canvas>
</body>
</html>
